@page "/"
@inject HttpClient Http
@using MudBlazor
@using System.Globalization
@using MyApp.BlazorUI.DTOs
@inject IConfiguration Configuration
@inject NavigationManager NavManager
@inject ISnackbar Snackbar
@inject NavigationManager Navigation

<PageTitle>Lending Pages</PageTitle>

@* Hero Section  *@
<MudPaper Class="hero-section" Square="true">
  <MudContainer Class="hero-container">
    <MudText Typo="Typo.h4" Class="hero-title fade-in-slide-up">
      Be the next great chef
    </MudText>
    <MudText Typo="Typo.h6" Class="hero-subtitle fade-in-slide-up-delay">
      We are able to awaken your cooking skills to become a classy chef
      and ready to dive into the professional world
    </MudText>
  </MudContainer>
</MudPaper>

@* Statistic Section *@
<MudContainer MaxWidth="MaxWidth.Large" Class="py-6 px-3">
  <MudGrid Justify="Justify.Center" AlignItems="AlignItems.Stretch" Spacing="4">
    @foreach (StatItem stat in stats)
    {
      <MudItem xs="12" sm="6" md="4">
        <MudCard Class="stat-card h-100 fade-in-scale">
          <MudCardContent Class="stat-card-content">
            <MudText Typo="Typo.h4" Color="Color.Warning" Class="font-weight-bold">@stat.Number</MudText>
            <MudText Typo="Typo.body2">@stat.Description</MudText>
          </MudCardContent>
        </MudCard>
      </MudItem>
    }
  </MudGrid>
</MudContainer>

@* More Professional Class Section *@
<MudContainer Class="my-8">
  <MudText Typo="Typo.h4" Align="Align.Center" Class="mb-10 title-text fade-in-slide-down">
    More Professional Classes
  </MudText>

  @if (!Foods.Any())
  {
    <MudGrid Justify="Justify.Center">
      <MudProgressCircular Color="Color.Primary" Indeterminate="true" Class="bounce-in" />
    </MudGrid>
  }
  else
  {
    <MudGrid Spacing="4">
      @foreach (FoodItem item in Foods.Skip((currentPage - 1) * pageSize).Take(pageSize))
      {
        <MudItem xs="12" sm="6" md="4">
          <MudCard Elevation="1" @onclick="() => OnCardClick(item)" Class="card-hover my-card-style fade-in-stagger">
            <MudCardMedia Image="@item.Image" Height="250" Alt="@item.Title"
              Style="object-fit: cover; object-position: center;" />
            <MudCardContent>
              <MudText Typo="Typo.caption" Class="text-grey">@item.Category</MudText>
              <MudText Typo="Typo.subtitle1" Class="font-weight-bold">@item.Title</MudText>
              <div class="my-10"></div>
              <MudText Typo="Typo.body2" Color="Color.Warning" Class="font-weight-bold">@item.Price</MudText>
            </MudCardContent>
          </MudCard>
        </MudItem>
      }
    </MudGrid>

    <MudGrid Justify="Justify.Center" Class="mt-8">
      <MudPagination Count="(int)Math.Ceiling((double)totalItems / pageSize)" @bind-Selected="currentPage"
        Variant="Variant.Outlined" Color="Color.Warning" Class="fade-in-slide-up-delay" />
    </MudGrid>
  }
</MudContainer>

@* Benefit Section *@
<MudPaper Class="my-8 bg-benefit position-relative">
  <MudContainer MaxWidth="MaxWidth.Large" Class="benefit-container fade-in-slide-left">
    <MudText Typo="Typo.h2" Class="mb-2 text-white">Gets your best benefit</MudText>
    <MudText Typo="Typo.body1" Class="text-white">
      Our curriculum is designed to take you from enthusiast to expert.
      Explore a diverse range of global cuisines, understand the science behind flavor, and practice hands-on in
      our state-of-the-art kitchen.
      You'll learn more than just recipes; you'll learn the art and discipline
      necessary to excel in the professional culinary world.
    </MudText>
  </MudContainer>
</MudPaper>

@* Food Type Section *@
<MudContainer Class="food-container">
  <MudText Typo="Typo.h5" Align="Align.Center" Class="title-text fade-in-slide-down">
    More food type as you can choose
  </MudText>

  @* Foot Card *@
  @if (!FoodTypes.Any())
  {
    <MudGrid Justify="Justify.Center">
      <MudProgressCircular Color="Color.Primary" Indeterminate="true" Class="bounce-in" />
    </MudGrid>
  }
  else
  {
    <MudGrid Class="food-grid">
      @foreach (FoodType food in FoodTypes.Skip((categoryCurrentPage - 1) * categoryPageSize).Take(categoryPageSize))
      {
        <MudItem xs="12" sm="6" md="4" lg="3">
          <MudCard Elevation="1" @onclick="() => OnCategoryClick(food)" Class="card-hover food-type-card fade-in-stagger">
            <MudCardMedia Image="@food.Image" Alt="@food.Name" Height="150" />
            <MudCardContent>
              <MudText Typo="Typo.body1" Align="Align.Center" Class="food-type-title">
                @food.Name
              </MudText>
            </MudCardContent>
          </MudCard>
        </MudItem>
      }
    </MudGrid>
    <MudGrid Justify="Justify.Center" Class="mt-8">
      <MudPagination Count="(int)Math.Ceiling((double)categoryTotalItems / categoryPageSize)"
        @bind-Selected="categoryCurrentPage" Variant="Variant.Outlined" Color="Color.Warning"
        Class="fade-in-slide-up-delay" />
    </MudGrid>
  }
</MudContainer>

@code {
  // State untuk pagination
  private int currentPage = 1;
  private int pageSize = 6;
  private int totalItems = 0;
  private int categoryCurrentPage = 1;
  private int categoryPageSize = 8;
  private int categoryTotalItems = 0;

  public record FoodItem(int Id, string Image, string Category, string Title, string Price);
  public record FoodType(string Image, string Name);
  public record StatItem(string Number, string Description);

  private void OnCardClick(FoodItem item)
  {
    NavManager.NavigateTo($"/menu/detail/{item.Id}");
  }
  private void OnCategoryClick(FoodType food)
  {
    NavManager.NavigateTo($"/menu/{food.Name}");
  }

  public List<FoodItem> Foods = new List<FoodItem>();
  public List<FoodType> FoodTypes = new List<FoodType>();
  private List<StatItem> stats = new List<StatItem>()
{
new StatItem(Number: "200+", Description: "Various cuisines available in professional class"),
new StatItem(Number: "50+", Description: "A chef who is reliable and has his own characteristics in cooking"),
new StatItem(Number: "30+", Description: "Cooperate with trusted and upscale restaurants")
};
  private CultureInfo idCulture = new CultureInfo("id-ID");
  private string _apiBaseUrl = string.Empty;

  protected override async Task OnInitializedAsync()
  {
    var uri = new Uri(Navigation.Uri);
    var query = Microsoft.AspNetCore.WebUtilities.QueryHelpers.ParseQuery(uri.Query);

    _apiBaseUrl = (Configuration["ApiBaseUrl"] ?? "http://localhost:5099").TrimEnd('/');
    try
    {
      var categoryResponse = await Http.GetFromJsonAsync<ApiResponse<List<CategoryDto>>>("api/categories");
      if (categoryResponse?.Success == true && categoryResponse.Data != null)
      {
        FoodTypes = categoryResponse.Data
        .Select(dto => new FoodType(
        string.IsNullOrEmpty(dto.Image) ? "" : $"{_apiBaseUrl}/{dto.Image.TrimStart('/')}",
        dto.Name
        ))
        .ToList();
        categoryTotalItems = FoodTypes.Count;
      }

      var courseResponse = await Http.GetFromJsonAsync<ApiResponse<List<MenuCourseDto>>>("api/menucourses");
      if (courseResponse?.Success == true && courseResponse.Data != null)
      {
        Foods = courseResponse.Data
        .Select(dto => new FoodItem(
        dto.Id,
        string.IsNullOrEmpty(dto.Image) ? "" : $"{_apiBaseUrl}/{dto.Image.TrimStart('/')}",
        dto.CategoryName,
        dto.Name,
        "IDR " + dto.Price.ToString("N0", idCulture)
        ))
        .ToList();

        totalItems = Foods.Count;
      }
    }
    catch (Exception ex)
    {
      Console.WriteLine($"Failed to fetch data: {ex.Message}");
    }
  }

  protected override async Task OnAfterRenderAsync(bool firstRender)
  {
    if (firstRender)
    {
      // Trigger animations after initial render
      await Task.Delay(100); // Small delay for DOM readiness
      StateHasChanged(); // Re-render to apply animation classes
    }
  }
}

<style>
  .hero-section {
    background: url("/images/hero1.svg") center/cover no-repeat;
    width: 100%;
    min-height: 350px;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    text-align: center;
  }

  .hero-container {
    animation: fadeInUp 1s ease-out;
  }

  .hero-title {
    color: white;
    font-weight: bold;
    margin-bottom: 0.5rem;
  }

  .hero-subtitle {
    color: white;
    max-width: 900px;
    margin: 0 auto;
  }

  .font-weight-bold {
    font-weight: 700;
  }

  .stat-card {
    border: 1px solid #b4b4b4;
    min-height: 120px;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    padding: 1.5rem;
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
    border-radius: 24px;
  }

  .stat-card-content {
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    text-align: center;
    padding: 1.5rem;
  }

  .card-hover {
    cursor: pointer;
    transition: transform 0.3s ease, box-shadow 0.3s ease;
  }

  .card-hover:hover {
    transform: scale(1.05);
    box-shadow: 0 6px 18px rgba(0, 0, 0, 0.2);
  }

  .bg-benefit {
    background: url("/images/image1.svg") center/cover no-repeat;
  }

  .min-h-260 {
    min-height: 260px;
  }

  .max-w {
    max-width: 1200px;
  }

  .food-container {
    margin-top: 40px;
    margin-bottom: 40px;
  }

  .title-text {
    font-weight: 600;
    margin-bottom: 80px;
    color: rgb(0, 0, 0);
  }

  .food-grid {
    justify-content: center;
    /* ✅ PERBAIKAN: Padding horizontal (kiri/kanan) dihapus  */
    /* Biarkan MudContainer yang mengatur padding responsif */
  }

  .food-img {
    width: 100%;
    height: 150px;
    object-fit: cover;
  }

  .text-grey {
    color: grey;
  }

  .food-title {
    margin-top: 1rem;
    font-size: 1.25rem;
    text-align: center;
  }

  .benefit-container {
    display: flex;
    flex-direction: column;
    justify-content: center;
    min-height: 260px;
  }

  .my-card-style {
    width: 100%;
    margin: auto;
    height: 100%;
  }

  /* ✅ PERBAIKAN: Style dipindahkan dari inline ke class CSS  */
  .food-type-card {
    height: 100%;
  }

  .food-type-title {
    font-size: 1.1rem;
    font-weight: 500;
    padding: 0;
    margin-top: 0;
  }

  /* Animations */
  @@keyframes fadeInUp {
    0% {
      opacity: 0;
      transform: translateY(30px);
    }

    100% {
      opacity: 1;
      transform: translateY(0);
    }
  }

  .fade-in-slide-up {
    animation: fadeInUp 1s ease-out;
  }

  .fade-in-slide-up-delay {
    animation: fadeInUp 1s ease-out 0.3s both;
  }

  .fade-in-slide-down {
    animation: fadeInDown 1s ease-out 0.5s both;
  }

  @@keyframes fadeInDown {
    0% {
      opacity: 0;
      transform: translateY(-30px);
    }

    100% {
      opacity: 1;
      transform: translateY(0);
    }
  }

  .fade-in-scale {
    animation: fadeInScale 0.8s ease-out 0.7s both;
  }

  @@keyframes fadeInScale {
    0% {
      opacity: 0;
      transform: scale(0.8);
    }

    100% {
      opacity: 1;
      transform: scale(1);
    }
  }

  .fade-in-stagger {
    animation: fadeInStagger 0.6s ease-out both;
  }

  @@keyframes fadeInStagger {
    0% {
      opacity: 0;
      transform: translateY(20px);
    }

    100% {
      opacity: 1;
      transform: translateY(0);
    }
  }

  .fade-in-slide-left {
    animation: fadeInLeft 1s ease-out 0.9s both;
  }

  @@keyframes fadeInLeft {
    0% {
      opacity: 0;
      transform: translateX(-50px);
    }

    100% {
      opacity: 1;
      transform: translateX(0);
    }
  }

  .bounce-in {
    animation: bounceIn 1s ease-in-out;
  }

  @@keyframes bounceIn {
    0% {
      transform: scale(0.3);
      opacity: 0;
    }

    50% {
      transform: scale(1.05);
    }

    70% {
      transform: scale(0.9);
    }

    100% {
      transform: scale(1);
      opacity: 1;
    }
  }
</style>